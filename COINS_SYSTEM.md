# AI Coins —Å–∏—Å—Ç–µ–º–∞ ü™ô

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è AI –º–æ–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ –±–æ—Ç–µ.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∫–æ–∏–Ω–æ–≤

### 1. **–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ (/start)** - `+100 –º–æ–Ω–µ—Ç` ‚úÖ
   - –§–∞–π–ª: `main.py` (—Å—Ç—Ä–æ–∫–∏ ~95-104)
   - –£—Å–ª–æ–≤–∏–µ: –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è = 0
   - –ü—Ä–∏—á–∏–Ω–∞: "—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
   - –û–ø–∏—Å–∞–Ω–∏–µ: "–ë–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ /start"

### 2. **–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Personal)** - `+50 –º–æ–Ω–µ—Ç` ‚úÖ
   - –§–∞–π–ª: `handlers/personal_direction.py` (—Å—Ç—Ä–æ–∫–∏ ~27-34)
   - –î–µ–π—Å—Ç–≤–∏–µ: –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–î–ª—è –ª–∏—á–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"
   - –ü—Ä–∏—á–∏–Ω–∞: "–≤—ã–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
   - –û–ø–∏—Å–∞–Ω–∏–µ: "–ë–æ–Ω—É—Å –∑–∞ –≤—ã–±–æ—Ä –ª–∏—á–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (personal)"

### 3. **–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Business)** - `+50 –º–æ–Ω–µ—Ç` ‚úÖ
   - –§–∞–π–ª: `handlers/business_direction.py` (—Å—Ç—Ä–æ–∫–∏ ~24-31)
   - –î–µ–π—Å—Ç–≤–∏–µ: –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–î–ª—è –±–∏–∑–Ω–µ—Å–∞ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è"
   - –ü—Ä–∏—á–∏–Ω–∞: "–≤—ã–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
   - –û–ø–∏—Å–∞–Ω–∏–µ: "–ë–æ–Ω—É—Å –∑–∞ –≤—ã–±–æ—Ä –±–∏–∑–Ω–µ—Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (business)"

### 4. **–ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä** - `+100 –º–æ–Ω–µ—Ç` ‚úÖ
   - –§–∞–π–ª: `handlers/registration.py` (—Å—Ç—Ä–æ–∫–∏ ~81-88)
   - –î–µ–π—Å—Ç–≤–∏–µ: –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –£–ß–ê–°–¢–ò–ï"
   - –ü—Ä–∏—á–∏–Ω–∞: "–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"
   - –û–ø–∏—Å–∞–Ω–∏–µ: "–ë–æ–Ω—É—Å –∑–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä"

## –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –ø—Ä–∏ —Ñ–ª–æ—É

```
/start                                 = 100 –º–æ–Ω–µ—Ç
–í—ã–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Personal/Business)  = 50  –º–æ–Ω–µ—Ç
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä   = 100 –º–æ–Ω–µ—Ç
                                        ============
–í—Å–µ–≥–æ –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Ñ–ª–æ—É                = 250 –º–æ–Ω–µ—Ç ‚úÖ
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ú–æ–¥—É–ª–∏

#### `coin_service.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å
–°–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏:
- `add_coins(telegram_id, amount, reason, description)` - –Ω–∞—á–∏—Å–ª–∏—Ç—å –º–æ–Ω–µ—Ç—ã
- `subtract_coins(telegram_id, amount, reason, description)` - —Å–ø–∏—Å–∞—Ç—å –º–æ–Ω–µ—Ç—ã
- `get_balance(telegram_id)` - –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
- `get_user_with_coins(telegram_id)` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ –≤—Å–µ–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

#### `models.py` - –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
- **User.ai_coins_balance** - –ø–æ–ª–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –º–æ–Ω–µ—Ç
- **AICoinOperation** - —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –º–æ–Ω–µ—Ç–∞–º–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–¢–∞–±–ª–∏—Ü–∞ `ai_coin_operations`:
```sql
CREATE TABLE ai_coin_operations (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    amount INTEGER NOT NULL,
    operation_type VARCHAR(50) NOT NULL,  -- EARNED –∏–ª–∏ SPENT
    reason VARCHAR(255),
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç
```python
from coin_service import add_coins

await add_coins(
    telegram_id=callback.from_user.id,
    amount=100,
    reason="—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
    description="–ë–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ"
)
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
```python
from coin_service import get_balance

balance = await get_balance(callback.from_user.id)
print(f"–í–∞—à –±–∞–ª–∞–Ω—Å: {balance} –º–æ–Ω–µ—Ç")
```

### –°–ø–∏—Å–∞–Ω–∏–µ –º–æ–Ω–µ—Ç
```python
from coin_service import subtract_coins

result = await subtract_coins(
    telegram_id=callback.from_user.id,
    amount=50,
    reason="–ø–æ–∫—É–ø–∫–∞",
    description="–ü–æ–∫—É–ø–∫–∞ –∫—É—Ä—Å–∞"
)
if result == -1:
    print("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç")
else:
    print(f"–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: {result}")
```

## –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ó–∞–ø—É—Å—Ç–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é:
```bash
# –í psql –∏–ª–∏ —á–µ—Ä–µ–∑ –≤–∞—à –∫–ª–∏–µ–Ω—Ç PostgreSQL
\i migrations/create_ai_coins_table.sql
```

## –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç `/start` ‚Üí `+100 –º–æ–Ω–µ—Ç` (–±–∞–ª–∞–Ω—Å: 100)
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí `+50 –º–æ–Ω–µ—Ç` (–±–∞–ª–∞–Ω—Å: 150)
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ó–ê–ë–†–ê–¢–¨ –ü–û–î–ê–†–û–ö –ò –ó–ê–ü–ò–°–ê–¢–¨–°–Ø" ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ –≤–µ–±–∏–Ω–∞—Ä–∞–º
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä ‚Üí `+100 –º–æ–Ω–µ—Ç` (–±–∞–ª–∞–Ω—Å: 250)
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: "–¢–≤–æ–π –±–∞–ª–∞–Ω—Å: 250 AI-Coins"

## –°—Ç–∞—Ç—É—Å—ã –æ–ø–µ—Ä–∞—Ü–∏–π

- **EARNED** - –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã (–Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ)
- **SPENT** - –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã (—Å–ø–∏—Å–∞–Ω–Ω—ã–µ)
- **REFUND** - –≤–æ–∑–≤—Ä–∞—Ç –º–æ–Ω–µ—Ç (–¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ `ai_coins_balance` —Ç–∞–±–ª–∏—Ü—ã `users`
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `ai_coin_operations` –¥–ª—è –∞—É–¥–∏—Ç–∞
- –ü—Ä–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç) —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `-1`
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQLAlchemy async API


