# ü™ô –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ AI Coins —Å–∏—Å—Ç–µ–º–µ

## –ì–¥–µ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –º–æ–Ω–µ—Ç—ã?

| –°–æ–±—ã—Ç–∏–µ | –ú–æ–Ω–µ—Ç—ã | –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞ |
|---------|--------|------|--------|
| üü¢ –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ `/start` | +100 | `main.py` | 97-104 |
| üîµ –í—ã–±–æ—Ä Personal | +50 | `handlers/personal_direction.py` | 27-34 |
| üü£ –í—ã–±–æ—Ä Business | +50 | `handlers/business_direction.py` | 24-31 |
| üü† –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ | +100 | `handlers/registration.py` | 81-88 |
| **–ò–¢–û–ì–û** | **250** | | |

## –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

```
/balance              - –º–æ–π –±–∞–ª–∞–Ω—Å
/balance 123456789    - –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
/user_stats           - –º–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
/user_stats 123456789 - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

## –§—É–Ω–∫—Ü–∏–∏ –∏–∑ coin_service.py

```python
# –ù–∞—á–∏—Å–ª–∏—Ç—å –º–æ–Ω–µ—Ç—ã
await add_coins(telegram_id, amount, reason, description)

# –°–ø–∏—Å–∞—Ç—å –º–æ–Ω–µ—Ç—ã
await subtract_coins(telegram_id, amount, reason, description)

# –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å
balance = await get_balance(telegram_id)

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏
user = await get_user_with_coins(telegram_id)
```

## –¢–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ

**users.ai_coins_balance** - –±–∞–ª–∞–Ω—Å –º–æ–Ω–µ—Ç (NULL = 0)

**ai_coin_operations** - –ª–æ–≥ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
- id
- user_id
- amount (+ –¥–ª—è earned, - –¥–ª—è spent)
- operation_type (earned/spent/refund)
- reason
- description
- created_at

## –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

```bash
psql -U user -d database -f migrations/create_ai_coins_table.sql
```

## SQL –∑–∞–ø—Ä–æ—Å—ã

### –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
SELECT ai_coins_balance FROM users WHERE telegram_id = 123456789;
```

### –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
```sql
SELECT * FROM ai_coin_operations 
WHERE user_id = (SELECT id FROM users WHERE telegram_id = 123456789)
ORDER BY created_at DESC;
```

### –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```sql
SELECT telegram_id, user_name, ai_coins_balance 
FROM users 
ORDER BY ai_coins_balance DESC LIMIT 10;
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. `/start` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å = 100
2. –í—ã–±—Ä–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å = 150
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å = 250
4. –ö–æ–º–∞–Ω–¥–∞ `/balance` ‚Üí –≤—ã–≤–æ–¥ "–ë–∞–ª–∞–Ω—Å: 250 –º–æ–Ω–µ—Ç"

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

‚ö†Ô∏è –ë–∞–ª–∞–Ω—Å –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å = 0 –ø—Ä–∏ `/start`

‚ö†Ô∏è –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `ai_coin_operations`

‚ö†Ô∏è –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ (async/await)

‚ö†Ô∏è –ú–æ–Ω–µ—Ç—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏

‚ö†Ô∏è –ü—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è -1 –µ—Å–ª–∏ –¥–µ–Ω–µ–≥ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

## –§–∞–π–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ –æ–±–Ω–æ–≤–∏—Ç—å

‚úÖ coin_service.py - –°–û–ó–î–ê–ù
‚úÖ models.py - –û–ë–ù–û–í–õ–Å–ù
‚úÖ main.py - –û–ë–ù–û–í–õ–Å–ù
‚úÖ handlers/personal_direction.py - –û–ë–ù–û–í–õ–Å–ù
‚úÖ handlers/business_direction.py - –û–ë–ù–û–í–õ–Å–ù
‚úÖ handlers/registration.py - –û–ë–ù–û–í–õ–Å–ù
‚úÖ handlers/admin.py - –û–ë–ù–û–í–õ–Å–ù
‚úÖ migrations/create_ai_coins_table.sql - –°–û–ó–î–ê–ù

## –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

### –¢–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π
- **EARNED** - –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ (–Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ)
- **SPENT** - –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã–µ (—Å–ø–∏—Å–∞–Ω–Ω—ã–µ)
- **REFUND** - –≤–æ–∑–≤—Ä–∞—Ç

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏—á–∏–Ω (reason)
- "—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
- "–≤—ã–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
- "–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"
- "–ø–æ–∫—É–ø–∫–∞"
- "–≤–æ–∑–≤—Ä–∞—Ç"


